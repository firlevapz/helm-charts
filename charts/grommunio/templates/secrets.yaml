{{/*
Database secrets - only created if existingSecret is not set
*/}}

{{- if and .Values.databases.gromox.enabled (not .Values.databases.gromox.existingSecret) }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "grommunio.gromoxDb.fullname" . }}
  labels:
    {{- include "grommunio.gromoxDb.labels" . | nindent 4 }}
type: Opaque
data:
  mariadb-root-password: {{ .Values.databases.gromox.rootPassword | default (randAlphaNum 32) | b64enc | quote }}
  mariadb-password: {{ .Values.databases.gromox.password | default (randAlphaNum 32) | b64enc | quote }}
  mariadb-user: {{ .Values.databases.gromox.user | b64enc | quote }}
  mariadb-database: {{ .Values.databases.gromox.database | b64enc | quote }}
{{- end }}

{{- if and .Values.databases.chat.enabled (not .Values.databases.chat.existingSecret) }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "grommunio.chatDb.fullname" . }}
  labels:
    {{- include "grommunio.chatDb.labels" . | nindent 4 }}
type: Opaque
data:
  mariadb-root-password: {{ .Values.databases.chat.rootPassword | default (randAlphaNum 32) | b64enc | quote }}
  mariadb-password: {{ .Values.databases.chat.password | default (randAlphaNum 32) | b64enc | quote }}
  mariadb-user: {{ .Values.databases.chat.user | b64enc | quote }}
  mariadb-database: {{ .Values.databases.chat.database | b64enc | quote }}
{{- end }}

{{- if and .Values.databases.files.enabled (not .Values.databases.files.existingSecret) }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "grommunio.filesDb.fullname" . }}
  labels:
    {{- include "grommunio.filesDb.labels" . | nindent 4 }}
type: Opaque
data:
  mariadb-root-password: {{ .Values.databases.files.rootPassword | default (randAlphaNum 32) | b64enc | quote }}
  mariadb-password: {{ .Values.databases.files.password | default (randAlphaNum 32) | b64enc | quote }}
  mariadb-user: {{ .Values.databases.files.user | b64enc | quote }}
  mariadb-database: {{ .Values.databases.files.database | b64enc | quote }}
{{- end }}

{{- if and .Values.databases.office.enabled (not .Values.databases.office.existingSecret) }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "grommunio.officeDb.fullname" . }}
  labels:
    {{- include "grommunio.officeDb.labels" . | nindent 4 }}
type: Opaque
data:
  mariadb-root-password: {{ .Values.databases.office.rootPassword | default (randAlphaNum 32) | b64enc | quote }}
  mariadb-password: {{ .Values.databases.office.password | default (randAlphaNum 32) | b64enc | quote }}
  mariadb-user: {{ .Values.databases.office.user | b64enc | quote }}
  mariadb-database: {{ .Values.databases.office.database | b64enc | quote }}
{{- end }}

{{- if and .Values.databases.archive.enabled (not .Values.databases.archive.existingSecret) }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "grommunio.archiveDb.fullname" . }}
  labels:
    {{- include "grommunio.archiveDb.labels" . | nindent 4 }}
type: Opaque
data:
  mariadb-root-password: {{ .Values.databases.archive.rootPassword | default (randAlphaNum 32) | b64enc | quote }}
  mariadb-password: {{ .Values.databases.archive.password | default (randAlphaNum 32) | b64enc | quote }}
  mariadb-user: {{ .Values.databases.archive.user | b64enc | quote }}
  mariadb-database: {{ .Values.databases.archive.database | b64enc | quote }}
{{- end }}
